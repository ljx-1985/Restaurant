# 项目测试计划 - 餐厅菜品精准推荐系统

## 1. 引言

### 1.1. 目的
本文档旨在定义餐厅菜品精准推荐系统的测试策略、范围、方法和资源，确保系统功能的正确性、稳定性和性能满足需求。

### 1.2. 项目背景
本项目旨在开发一个基于Node.js的Web端菜品精准推荐系统。前端（小程序/平板）采集用户健康限制，Web端接收信息后，通过智能推荐引擎实时过滤和推荐菜品。

### 1.3. 文档范围
本文档覆盖了单元测试、集成测试和性能测试的计划。后续阶段可扩展至更详细的安全测试和用户验收测试。

## 2. 测试范围

### 2.1. 测试的功能模块
- **核心推荐逻辑 (`core/recommending.js`)**:
    - 菜品数据加载与解析
    - 安全过滤（疾病、忌口/过敏原）
    - 口味偏好过滤 (`flavor_preferences`)
    - 菜品评分机制
    - 按品类推荐逻辑
    - 辅助函数及数据结构校验
- **API 服务 (`app.js`)**:
    - `/test` 路由
    - `/` 和 `/index.html` 静态文件服务及路由
    - `/diagnose` 诊断信息接口
    - `/recommend` 核心推荐接口 (包括功能、错误处理、`flavor_preferences` 处理和性能)
- **前端静态文件服务**:
    - `index.html`
    - `script.js`
    - `style.css`

### 2.2. 不在测试范围内（当前阶段）
- 完整的前端用户界面交互测试（依赖于实际的小程序/平板实现）
- 详尽的压力测试 (当前已进行基础性能/负载测试)
- 深入的安全渗透测试 (当前已进行基础XSS防护和安全头配置)
- 数据库持久化逻辑测试（如果未来引入数据库）

## 3. 测试策略与方法

### 3.1. 测试层级
- **单元测试 (Unit Testing)**: 针对 JavaScript 函数/模块进行，特别是 `core/recommending.js` 中的业务逻辑。
- **集成测试 (Integration Testing)**: 针对 API 端点，测试模块间的交互，特别是 `app.js` 中的路由和对核心逻辑的调用。

### 3.2. 测试类型
- **功能测试**: 验证系统是否按预期执行其功能。
- **正确性测试**: 验证计算和过滤逻辑的准确性。
- **错误处理测试**: 验证系统对无效输入或异常情况的处理。
- **性能测试**: 验证API在高负载下的响应时间和稳定性。

### 3.3. 测试工具
- **Jest**: 主要的 JavaScript 测试框架，用于单元测试和部分集成测试。
- **Supertest**: 用于测试 Express API 端点。
- **Artillery**: 用于API性能和负载测试。

## 4. 测试环境

- **操作系统**: 开发人员本地环境 (Windows, macOS, Linux)
- **运行时**: Node.js (具体版本与项目 `package.json` 中引擎设置一致，如 >=18.x.x)
- **依赖项**: 项目 `package.json` 中定义的依赖和开发依赖。
- **测试数据**:
    - `dishes.json` (或其精简/特定版本用于测试)
    - 测试用例中定义的模拟数据

## 5. 测试准则

### 5.1. 开始准则
- 相关的模块代码已完成开发并通过代码审查（如果适用）。
- 测试环境已准备就绪。
- 测试用例已编写完成。

### 5.2. 通过准则
- **单元测试**: 核心功能模块（如 `core/recommending.js`）的单元测试覆盖率达到预定目标（例如 80%+），所有测试用例通过。
- **集成测试**: 所有定义的 API 端点集成测试用例通过。
- 没有严重级别（Blocker, Critical）的缺陷。

### 5.3. 暂停与恢复准则
- **暂停**: 若发现阻断性缺陷导致大部分测试无法继续，则暂停测试，待缺陷修复后再恢复。
- **恢复**: 阻断性缺陷已修复并验证通过。

### 5.4. 退出准则 (测试完成标准)
- 所有定义的测试用例已执行完毕。
- 测试通过率达到预设标准。
- 所有发现的严重和高级别缺陷已修复并回归测试通过。
- 测试报告和相关文档已完成。

## 6. 测试交付物
- 本测试计划文档 (`测试计划.md`)。
- 测试用例代码 (如 `app.test.js` 等)。
- 测试完成清单 (`测试完成清单.md`)。
- 测试执行结果 (Jest 输出日志)。
- （可选）缺陷报告。

## 7. 测试资源与职责

| 角色       | 职责                                                     | 负责人 |
|------------|----------------------------------------------------------|--------|
| AI 助手    | 生成测试用例代码、执行测试、协助分析测试结果、更新测试文档 | Gemini |
| 用户/开发者 | 审查测试计划和用例、确认缺陷、提供业务逻辑澄清、修复缺陷     | 用户   |

## 8. 风险与缓解措施

| 风险点                                 | 可能性 | 影响程度 | 缓解措施                                                     |
|----------------------------------------|--------|----------|--------------------------------------------------------------|
| 测试数据不充分，无法覆盖所有场景         | 中     | 高       | 设计多样化的模拟数据；使用真实数据的脱敏子集。                     |
| 测试环境与生产环境不一致导致结果偏差     | 低     | 中       | 尽量保持环境配置一致；明确记录环境差异。                         |
| 需求变更导致测试用例频繁修改             | 中     | 中       | 保持与开发同步，及时更新测试用例；模块化测试用例以降低维护成本。 |
| 核心算法复杂，难以设计全面的测试用例   | 中     | 高       | 采用等价类划分、边界值分析等方法；代码审查辅助。                 |
| 测试时间不足                             | 中     | 中       | 优先测试核心功能和高风险模块；自动化测试提高效率。             |

## 9. 测试进度与排期 (高级别)
- **阶段一：单元测试、基础集成测试、基础安全测试与性能测试** (当前阶段)
    - `core/recommending.js` 单元测试：已完成
    - `app.js` API 端点集成测试 (基础功能、错误处理、基础安全)：已完成
    - `app.js` API 端点性能测试 (`/recommend`)：已完成
- **阶段二：扩展集成测试与错误处理测试** (后续)
- **阶段三：(如适用) 深入安全测试、用户验收测试** (未来)

---
*本文档将根据项目进展和需求变化进行更新。* 